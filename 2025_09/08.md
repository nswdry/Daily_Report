# 2025年9月8日(月)

# やったこと📝

- [プラクティス プログラムの修正（リバーシ編）（Reスキル） \| FBC](https://bootcamp.fjord.jp/practices/321)
  - [初心者プログラマーに伝えたいデバッグの話 \#debug \- Qiita](https://qiita.com/jyori112/items/2cd6e40b5570b90eda45)
  - [printデバッグにさようなら！Ruby初心者のためのByebugチュートリアル \#byebug \- Qiita](https://qiita.com/jnchito/items/5aaf323ab4f24b526a61)
  - [デバッグ｜RubyMine入門](https://zenn.dev/ikuma/books/how-to-use-redimine/viewer/debug)
# わかったこと💡
## デバッグの手順

テストを起点に、再現→観察→仮説→修正→検証で行うのが効果的のようです。

### 1. テストを実行

- どのテストが落ちているのかを確認する
- エラーメッセージをざっと眺める
- 全体像を把握する

### 2. バグの再現

- バグが確実に存在することを確認し、いつ、どういう条件でバグが起こるのかを明確に整理する

### 3. 仮説をたてて原因を特定する

- テストが失敗している個所の周辺のロジックを確認する
- ログやprintデバッグで変数の値や処理の流れを確認

### 4. 修正する

- バグを引き起こしていたコードを見つけたら ***根本原因に対処するように*** 修正する
  - その場しのぎではなく、ロジックの整合性を見直す

### 5. テストを再実行して修正を検証
- 修正後に全てのテストを再実行して、問題が解決されたかを確認する
- 他のテストが壊れていないことも重要

## RubyMineでデバッグしてみました。
:::details プログラムの修正(Reスキル)
```ruby
  3) Failure:
ReversiMethodsTest#test_finished_of_quickest_win_board [test/reversi_methods_test.rb:120]:
Expected false to be truthy.
```
RubyMineで見に行ったらエラーの順番変わった気もしますが、最初に見たときに一番上にあったやつを見にいきました。

このエラーの意味は、
- `ReversiMethodsTest`というテストクラスの`test_finished_of_quickest_win_board `というメソッドが失敗しましたという意味です。
- 失敗したのは`test/reversi_methods_test.rb`の120行目。
- false が返ってきたけど、true または truthy な値を期待していた。

ということで、とりあえず120行目を見にいきます。

```ruby
def test_finished_of_quickest_win_board
    assert finished?(build_board(<<~BOARD)) # 白最短勝利
      --------
      ---W----
      ---WW---
      -WWWWW--
      ---WWW--
      ---WWW--
      --------
      --------
    BOARD
```
すると上記のコードがあり、おそらく白が最短処理してゲーム終了になっているかを判定するテストなのかなと思います。

これが`false`になっているのがエラーの原因だと考え、さらに呼び出し元のコードを見にいきます。

```ruby
# reversi.rb

def finished?(board)
    !placeable?(board, WHITE_STONE) && !placeable?(board, BLACK_STONE)
  end

def placeable?(board, attack_stone_color)
    board.each_with_index do |cols, row|
      cols.each_with_index do |cell, col|
        next unless cell == BLANK_CELL

        position = Position.new(row, col)
        return true if put_stone(board, position.to_cell_ref, attack_stone_color, dry_run: true)
      end
    end
  end
```
この辺が怪しそうなのでとりあえずデバッガに働いてもらいます。RubyMineでは赤い丸をつければそこで処理が止まってくれるようなので、真偽値を判定するあたりに印を付けてみてから実行します。

と思ったら急にRubyMineが動かなくなったので明日頑張って再度デバッグしてみます！


ついでにこの間見つけたバグです。
```ruby
 ~/workspace/bug_reversi ❯  debug  ruby reversi.rb                  
  a b c d e f g h
1 - - - - - - - -
2 - - - - - - - -
3 - - - - - - - -
4 - - - ○ ● - - -
5 - - - ● ○ - - -
6 - - - - - - - -
7 - - - - - - - -
8 - - - - - - - -
command? (黒●) > f4
配置成功、次のターン
  a b c d e f g h
1 - - - - - - - -
2 - - - - - - - -
3 - - - - - - - -
4 - - - ○ ● - - -
5 - - - ● ● - - -
6 - - - ● - - - -
7 - - - - - - - -
8 - - - - - - - -
```
通常置けないはずの場所に置けたと思ったら違う場所に置かれています。
:::

# 次にやること✅

- [プラクティス プログラムの修正（リバーシ編）（Reスキル） \| FBC](https://bootcamp.fjord.jp/practices/321)

# いまの気持ち🫶

なんかちょうどRubyMineが非商用利用なら無料で使えるようになったという情報を見かけたので早速使ってみました。よくわからないですが、新しいものにはとりあえず触れてみたいので使います！
VSCodeよりさらに直感的に操作できる気がするので私的には使いやすいように感じました。

# 学習時間

- 2時間30分(合計: 519時間)
