# 2025年9月18日(木)

# やったこと📝

- [プラクティス プログラムの修正（リバーシ編）（Reスキル） \| FBC](https://bootcamp.fjord.jp/practices/321)

# わかったこと💡
:::details プログラムの修正
```ruby
# エラーメッセージ
ReversiMethodsTest test_finished_of_quickest_win_board [test/reversi_methods_test.rb:120]:Expected false to be truthy.

# エラーが発生したテスト部分
def test_finished_of_quickest_win_board
    assert finished?(build_board(<<~BOARD)) # ここ
      --------
      ---W----
      ---WW---
      -WWWWW--
      ---WWW--
      ---WWW--
      --------
      --------
    BOARD
    assert finished?(build_board(<<~BOARD)) # 黒最短勝利
      --------
      --------
      ----B---
      ---BBB--
      --BBBBB-
      ---BBB--
      ----B---
      --------
    BOARD
  end
```
昨日、白石と黒石の両方でテストが落ちていることが確認できたので怪しい部分のコードを見に行きます。
```ruby 
def finished?(board)
    !placeable?(board, WHITE_STONE) && !placeable?(board, BLACK_STONE)
  end

  def placeable?(board, attack_stone_color)
    board.each_with_index do |cols, row|
      cols.each_with_index do |cell, col|
        next unless cell == BLANK_CELL

        position = Position.new(row, col)
        return true if put_stone(board, position.to_cell_ref, attack_stone_color, dry_run: true)
      end
    end
  end
```
まずテスト内で実行している`finished?`メソッドを見に行きます。ついでに`placeable?`メソッドも確認します。`finished?`メソッドは白石が置けない、かつ黒石も置けない場合にtrueを返し、そうでないときはfalseを返すメソッドですが、まずこのテストではfalseが返ってきており、まだ盤上に置ける石があるという判定になっています。
恐らく両方の石が置ける判定であると思いますが、念のため各色の石ごとにfalseが返ってきているかデバッガで確認します。

### 白石も黒石も置けるかどうか
```ruby
 def finished?(board)
    77|     binding.break
=>  78|     !placeable?(board, WHITE_STONE) && !placeable?(board, BLACK_STONE)
    79|   end
    80| 
    81|   def placeable?(board, attack_stone_color)
    82|     board.each_with_index do |cols, row|
=>#0    ReversiMethods#finished?(board=[["-", "-", "-", "-", "-", "-", "-", "-"...) at ~/workspace/bug_reversi/lib/reversi_methods.rb:78
  #1    block in run at reversi.rb:19
  # and 3 frames (use `bt' command for all frames)
(ruby) placeable?(board, WHITE_STONE)
true
(ruby) placeable?(board, BLACK_STONE)
true
```
両方とも`true `が返ってきているため、どちらの色も置けるという判定になっていますね！

次に、`placeable?`メソッドに問題がないか調べます。`placeable?`メソッドは盤上のすべてのマスを調べ、空白のマスに石が置けるかどうかを判定するメソッドです。

## next unless
条件条件がfalseならnextを実行する
```ruby
next unless cell == BLANK_CELL
# 空白でない場合、処理をスキップ
# セルが空白との時に以下を実行
position = Position.new(row, col)return true if put_stone(board, position.to_cell_ref, attack_stone_color, dry_run: true)
```
新しい`Position`オブジェクトを作成し、変数`position`に代入する。実際に石は置かないが、もし石を（盤面、座標、攻撃側の石の色を指定して）置けた場合、trueを返す。
:::
## dry_run
実際にファイルを変更する操作は実行せず、操作を表示します。
引用：https://docs.ruby-lang.org/ja/latest/class/FileUtils=3a=3aDryRun.html

# 次にやること✅

- [プラクティス プログラムの修正（リバーシ編）（Reスキル） \| FBC](https://bootcamp.fjord.jp/practices/321)

# いまの気持ち🫶

RubyMineでデバッグしていたらやっぱり思った通りの動きをしてくれなくて、RubyMine側は正常なのですが自分自身の知識不足で上手くデバッグできないので悔しさもありますが、一旦できるところからやっていこうと思います！

そしてちょっとコードをいじったらもう一つエラーが解決したのですが理由はいまいちよくわからないのでまた調べます…

# 学習時間

- 3時間15分(合計: 542時間45分)
