# 2025年9月21日(日)

# やったこと📝

- [プラクティス プログラムの修正（リバーシ編）（Reスキル） \| FBC](https://bootcamp.fjord.jp/practices/321)
  - [再帰処理とは｜「分かりそう」で「分からない」でも「分かった」気になれるIT用語辞典](https://wa3.i-3-i.info/word14899.html)
# わかったこと💡
## 置けない場所に置ける判定が出る問題

:::details put_stoneメソッドの内容
```ruby
# エラーメッセージ
  1) Failure:
ReversiMethodsTest#test_cannot_put_stone [test/reversi_methods_test.rb:73]:
Expected true to not be truthy.

# 実行したメソッド
def test_cannot_put_stone
    initial_data = <<~BOARD
      W-WWWW--  # このB1に黒石が置けるという判定になっている
      W-BWWW--
      WBWWWWW-
      WWBWWW--
      WBBBBB--
      --B-----
      --B-----
      --B-----
    BOARD
    board = build_board(initial_data)
    refute put_stone(board, 'b1', BLACK_STONE)　# エラー判定されたのはこの行
    assert_equal build_board(initial_data), board
  end
```

エラーが発生した行で`put_stone`メソッドを実行しているので、まずは`put_stone`メソッドを確認します。

```ruby
def put_stone(board, cell_ref, stone_color, dry_run: false)
    pos = Position.new(cell_ref)
    raise '無効なポジションです' if pos.invalid?
    raise 'すでに石が置かれています' unless pos.stone_color(board) == BLANK_CELL

    # コピーした盤面にて石の配置を試みて、成功すれば反映する
    copied_board = Marshal.load(Marshal.dump(board))
    copied_board[pos.row][pos.col] = stone_color

    turn_succeed = false
    Position::DIRECTIONS.each do |direction|
      next_pos = pos.next_position(direction)
      turn_succeed = true if turn(copied_board, next_pos, stone_color, direction)
    end

    copy_board(board, copied_board) if !dry_run && turn_succeed

    turn_succeed
  end
```
まず、盤上外や無効な値の場合や空白ではない場合には例外を発生させて即終了する仕組みですが、今回は`b1`という有効かつ空白のマスのためコードが先へ進みます。

次にコピーした盤面を作り、コピー上の指定マスに石を置きます。

`turn_succeed`という変数を作り、`false`という値で初期化します。

- ループ処理
  - 8方向を順に取り出してループ処理を始め、石を置こうとしているマス（= pos）から、direction 方向に 1 マス進んだ位置をnext_posに代入します。

  - どの方向か1つでも裏返せれば`turn_succeed`を`true`にします。

コピーの盤面ではなく、かつどれか一方向でもひっくり返せた場合にコピー盤面を本物の盤面に反映します。

最後にひっくり返せたときはtrue、返せなかった場合はfalseを返して終了します。
:::

# 次にやること

- [プラクティス プログラムの修正（リバーシ編）（Reスキル） \| FBC](https://bootcamp.fjord.jp/practices/321)

# いまの気持ち🫶
`put_stone`メソッドが本当に何をやってるのか全く理解できなくて時間がかかりましたが、なんとか再就業まで解釈できた気がするのでとりあえずよかったです。

# 学習時間

- 3時間30分(合計: 548時間45分)
