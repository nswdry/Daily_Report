# 2025年10月6日(月)

# やったこと📝

- [Docs: lsコマンドを作る \| FBC](https://bootcamp.fjord.jp/pages/ls-command#requirements)

# わかったこと💡
## 要件
- オプション以外のコマンドライン引数(パス指定)なしで現在のディレクトリを対象として ls コマンドが実行されること
- 組み込みの ls は表示対象のパスをコマンドライン引数として指定することができますが、今回はパス指定は必須要件ではありません。
- 二つ以上のメソッドを自分で定義すること（メソッドの作り方を学ぶため）
- 横に最大3列を維持して表示する
  - 3,6,9,12のように3の倍数の件数だけでなく、それ以外の件数（3列目に空欄ができるケース）の結果も載せてください
  - ただし、「3列から5列に仕様変更してください」または「3列から100列に変えてください」とあとから言われても必要最小限の変更で対応できるようなロジックにしておくこと
- ファイルの並び順は列優先で列ごとに要素を並べること

## lsコマンドとの違い
まず1列表示と2列表示に分かれてしまった部分があります。lsコマンドなら2列表示になりましたが、作成したプログラムでは1列表示になっています。
```ruby
$ ls  
          
01.fizzbuzz       06.bowling_object
02.calendar       07.ls_object
03.bowling        98.rake
04.ls             99.wc_object
05.wc             README.md

$ ruby 04.ls/ls.rb

01.fizzbuzz      
02.calendar      
03.bowling       
04.ls            
05.wc            
06.bowling_object
07.ls_object     
98.rake          
99.wc_object     
README.md        
```
`irb`を用いて横幅を求めたところ、
```ruby
irb(main):001> rows, width = IO.console.winsize

=> [37, 37]
```
横幅は37でした。
また2列表示と3列表示に分かれてしまった部分の横幅も求めました。lsコマンドでは3列、作成したプログラムでは2列になっています。
```ruby
irb(main):001> rows, width = IO.console.winsize
=> [37, 55]
```
横幅は55でした。
両方とも、私が作成したプログラムの方が少ない列で表示されてしまっているので、最大サイズとしている部分の計算式で出てくる値がlsより大きくなっているのだと思います。
:::details lsコマンドを作る1

```ruby
def decide_columns(width, max_length)
  if width < 2 * (max_length + 2)
    1
  elsif width < 3 * (max_length + 2)
    2
  else
    3
  end
end

def format_entries(files, cols, max_length)
  rows = (files.size / cols.to_f).ceil
  max_length = files.map { |f| f.length }.max
  array = files.each_slice(rows).map{ |slice| slice.fill("", slice.size...rows)}.transpose

  array.each do |row|
    puts row.map{ |f| f.ljust(max_length)}.join(" ")
  end
end
```

現在のコード内で表示に関するコードは上記部分です。
また、最大ファイル名は「06.bowling_object」で17文字になり、現在のコードで計算すると、17+2＝19です。それぞれ2倍、3倍にした値が38、59のため、両方とも37、55を超えていて、動作としては正常です。2→3列表示になった時の方がずれが大きくなっているため、空白のカウントがおかしいのかと考えてまた明日計算してみます！

## IO/consoleの挙動について
```ruby
require 'io/console'
rows, cols = IO.console.winsize
```
で一応ターミナルのサイズは求められるのですが、使わない行まで求めてしまうと、rubocopに何か言われてしまうだろうなと気になっていたので、rowsを記載せずに済む方法を調べました。
```ruby
cols = IO.console.winsize[1]
```
上記のように配列の添字を使えば片方のみが取り出せるようです！！
:::

空白の数を微調整したところ、ほとんど同じような挙動になりましたので、明日rubocop等でチェックをして提出したいと思います。下記は横幅55の時の挙動。
```ruby
$ ruby 04.ls/ls.rb
01.fizzbuzz       05.wc             99.wc_object     
02.calendar       06.bowling_object README.md        
03.bowling        07.ls_object                       
04.ls             98.rake                            

$  ls              
01.fizzbuzz       05.wc             99.wc_object
02.calendar       06.bowling_object README.md
03.bowling        07.ls_object
04.ls             98.rake
```
# 次にやること✅

- [Docs: lsコマンドを作る \| FBC](https://bootcamp.fjord.jp/pages/ls-command#requirements)

# いまの気持ち🫶

なんとか今日中に自宅に帰宅できたので日報をかけて良かったです！日報書くだけなら外出中でも出来るのを思い出して次からは外でも書いていきたいと思います。課題に関しては機能自体は実装できたので明日以降`rubocop`に通して調整後、提出したいと思います。通してみたら違反12件と言われました。

# 学習時間

- 1時間(合計: 573時間15分)
